// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Analyst {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())

  googleAccessToken  String?
  googleRefreshToken String?
  googleTokenExpiry  DateTime?

  sessions       AnalystSession[]
  analystReports AnalystReport[]
}

model AnalystSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  analystId String
  analyst   Analyst  @relation(fields: [analystId], references: [id], onDelete: Cascade)

  @@index([analystId])
  @@index([expiresAt])
}

model Athlete {
  id                String          @id @default(cuid())
  name              String
  team              String
  position          String
  remainingMeetings Int             @default(0)
  photo             String          @default("")
  birthDate         DateTime?
  createdAt         DateTime        @default(now())

  meetings        Meeting[]
  reports         Report[]
  scouts          Scout[]
  athleteSessions AthleteSession[]
  analystReports  AnalystReport[]
}

model AthleteSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  athleteId String
  athlete   Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@index([athleteId])
  @@index([expiresAt])
}

model Scout {
  id         String      @id @default(cuid())
  youtubeUrl String
  counts     Json
  createdAt  DateTime    @default(now())

  athleteId  String
  athlete    Athlete     @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  clips      ScoutClip[]
  report     Report?
}

model ScoutClip {
  id          String   @id @default(cuid())
  start       Float
  end         Float
  label       String
  description String   @default("")
  confidence  String
  createdAt   DateTime @default(now())

  scoutId     String
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}

// Relat√≥rios de analistas para atletas (nova funcionalidade)
model AnalystReport {
  id          String   @id @default(cuid())
  title       String
  summary     String
  tags        String[]

  rating      Int      @default(0)
  intensity   Int      @default(0)
  decision    Int      @default(0)
  positioning Int      @default(0)

  clips       Json     @default("[]")

  analystName String
  analystId   String?
  analyst     Analyst? @relation(fields: [analystId], references: [id], onDelete: SetNull)

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([athleteId])
  @@index([analystId])
}

model Report {
  id          String   @id @default(cuid())
  title       String
  summary     String
  tags        Json
  rating      Int
  intensity   Int
  decision    Int
  positioning Int
  createdAt   DateTime @default(now())

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  scoutId     String   @unique
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}

model Meeting {
  id          String   @id @default(cuid())
  title       String
  description String   @default("")
  date        DateTime
  createdAt   DateTime @default(now())

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}
