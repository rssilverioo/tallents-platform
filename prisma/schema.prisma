// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  // ✅ obrigatório nesse provider
  // caminho relativo à pasta prisma/
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  // ⚠️ NÃO coloca url aqui no Prisma 7 (fica no prisma.config.ts)
}

model Analyst {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())

  sessions  AnalystSession[]
}

model AnalystSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  analystId String
  analyst   Analyst  @relation(fields: [analystId], references: [id], onDelete: Cascade)

  @@index([analystId])
  @@index([expiresAt])
}

model Athlete {
  id                String   @id @default(cuid())
  name              String
  team              String
  position          String
  remainingMeetings Int      @default(0)
  photo             String   @default("")
  createdAt         DateTime @default(now())

  scouts   Scout[]
  reports  Report[]
  meetings Meeting[]
}

model Scout {
  id         String      @id @default(cuid())
  youtubeUrl String
  counts     Json
  createdAt  DateTime    @default(now())

  athleteId  String
  athlete    Athlete     @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  clips      ScoutClip[]
  report     Report?
}

model ScoutClip {
  id          String   @id @default(cuid())
  start       Float
  end         Float
  label       String
  description String   @default("")
  confidence  String
  createdAt   DateTime @default(now())

  scoutId     String
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}

model Report {
  id          String   @id @default(cuid())
  title       String
  summary     String
  tags        Json
  rating      Int
  intensity   Int
  decision    Int
  positioning Int
  createdAt   DateTime @default(now())

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  scoutId     String   @unique
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}

model Meeting {
  id          String   @id @default(cuid())
  title       String
  description String   @default("")
  date        DateTime
  createdAt   DateTime @default(now())

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}
