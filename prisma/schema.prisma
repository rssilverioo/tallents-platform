// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Analyst {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())

  sessions       AnalystSession[]
  analystReports AnalystReport[]
  agendaEvents   AgendaEvent[]
}

model AnalystSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  analystId String
  analyst   Analyst  @relation(fields: [analystId], references: [id], onDelete: Cascade)

  @@index([analystId])
  @@index([expiresAt])
}

model Athlete {
  id                String          @id @default(cuid())
  name              String
  team              String
  position          String
  remainingMeetings Int             @default(0)
  photo             String          @default("")
  birthDate         DateTime?
  createdAt         DateTime        @default(now())

  reports        Report[]
  scouts         Scout[]
  athleteSessions AthleteSession[]
  analystReports  AnalystReport[]
  agendaEvents    AgendaEvent[]
}

model AthleteSession {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  athleteId String
  athlete   Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@index([athleteId])
  @@index([expiresAt])
}

model AgendaEvent {
  id          String   @id @default(cuid())
  title       String
  description String   @default("")
  startDate   DateTime
  endDate     DateTime

  // geral | atleta | pais | avaliacao | aula_experimental
  category  String  @default("geral")
  completed Boolean @default(false)

  analystId String
  analyst   Analyst @relation(fields: [analystId], references: [id], onDelete: Cascade)

  athleteId String?
  athlete   Athlete? @relation(fields: [athleteId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([analystId])
  @@index([startDate])
}

model Scout {
  id         String      @id @default(cuid())
  youtubeUrl String
  counts     Json
  createdAt  DateTime    @default(now())

  athleteId  String
  athlete    Athlete     @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  clips      ScoutClip[]
  report     Report?
}

model ScoutClip {
  id          String   @id @default(cuid())
  start       Float
  end         Float
  label       String
  description String   @default("")
  confidence  String
  createdAt   DateTime @default(now())

  scoutId     String
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}

model AnalystReport {
  id          String   @id @default(cuid())
  title       String
  summary     String
  tags        String[]

  rating      Int      @default(0)
  intensity   Int      @default(0)
  decision    Int      @default(0)
  positioning Int      @default(0)

  clips       Json     @default("[]")
  counts      Json     @default("{}")

  analystName String
  analystId   String?
  analyst     Analyst? @relation(fields: [analystId], references: [id], onDelete: SetNull)

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([athleteId])
  @@index([analystId])
}

model Report {
  id          String   @id @default(cuid())
  title       String
  summary     String
  tags        Json
  rating      Int
  intensity   Int
  decision    Int
  positioning Int
  createdAt   DateTime @default(now())

  athleteId   String
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  scoutId     String   @unique
  scout       Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
}
